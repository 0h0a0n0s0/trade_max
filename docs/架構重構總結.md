# Trade_Max æ¨¡çµ„åŒ–æ¶æ§‹é‡æ§‹ç¸½çµ

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

å·²æˆåŠŸå°‡ Trade_Max å¾ç·šæ€§è…³æœ¬é‡æ§‹ç‚ºæ¨¡çµ„åŒ–ã€AI-ready çš„æ¶æ§‹ï¼Œåƒè€ƒ Freqtrade è¨­è¨ˆç†å¿µï¼Œä¿ç•™åŸæœ‰ Grid + Trend äº¤æ˜“é‚è¼¯ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæ¶æ§‹çµ„ä»¶

#### âœ… BaseStrategyï¼ˆæŠ½è±¡åŸºé¡ï¼‰
- **ä½ç½®**: `strategy/base_strategy.py`
- **åŠŸèƒ½**: å®šç¾©ç­–ç•¥ä»‹é¢ï¼Œæä¾›ç‹€æ…‹å‘é‡å°å‡º
- **é—œéµæ–¹æ³•**:
  - `calculate_indicators()` - è¨ˆç®—æŠ€è¡“æŒ‡æ¨™
  - `generate_signals()` - ç”Ÿæˆäº¤æ˜“ä¿¡è™Ÿ
  - `update_config()` - å‹•æ…‹æ›´æ–°åƒæ•¸
  - `get_state_vector()` - å°å‡ºç‹€æ…‹å‘é‡

#### âœ… GridStrategyï¼ˆç¶²æ ¼ç­–ç•¥å¯¦ç¾ï¼‰
- **ä½ç½®**: `strategy/grid_strategy.py`
- **åŠŸèƒ½**: å¯¦ç¾ä¸‰å±¤ç¶²æ ¼é‚è¼¯ï¼ŒEMA è¶¨å‹¢åˆ¤æ–·
- **å¯èª¿æ•´åƒæ•¸**ï¼ˆé¡å±¬æ€§ï¼‰:
  - `small_gap` - å°ç¶²æ ¼é–“è·
  - `mid_multiplier`, `big_multiplier` - ç¶²æ ¼å€æ•¸
  - `ema_span_fast_bars`, `ema_span_slow_bars` - EMA é€±æœŸ
  - `bias_high`, `bias_low` - æ–¹å‘æ€§åç½®
  - `use_atr_spacing` - ATR å‹•æ…‹é–“è·
  - ç­‰ç­‰...

#### âœ… StrategyOptimizerï¼ˆAI Agentï¼‰
- **ä½ç½®**: `optimizer/strategy_optimizer.py`
- **åŠŸèƒ½**: è§€å¯Ÿå¸‚å ´ç‹€æ…‹ï¼Œå‹•æ…‹èª¿æ•´ç­–ç•¥åƒæ•¸
- **å·¥ä½œæµç¨‹**:
  1. è§€å¯Ÿå¸‚å ´ç‹€æ…‹ (`observe_market_state`)
  2. è¨ˆç®—æ–°åƒæ•¸ (`optimize_parameters`)
  3. æ‡‰ç”¨åƒæ•¸ (`apply_parameters`)
  4. è¨˜éŒ„ç¸¾æ•ˆ (`record_performance`)
- **ç•¶å‰å¯¦ç¾**: åŸºæ–¼è¦å‰‡çš„å„ªåŒ–ï¼ˆå¯æ“´å±•ç‚º RLï¼‰

#### âœ… BotEngineï¼ˆåŸ·è¡Œå¼•æ“ï¼‰
- **ä½ç½®**: `engine/bot_engine.py`
- **åŠŸèƒ½**: ç®¡ç†ä¸»å¾ªç’°ï¼ŒåŸ·è¡Œç­–ç•¥ä¿¡è™Ÿï¼Œå”èª¿å„ªåŒ–å™¨
- **ä¸»å¾ªç’°æµç¨‹**:
  1. æ›´æ–°åƒ¹æ ¼æ­·å²
  2. è¼ªè©¢è¨‚å–®ç‹€æ…‹
  3. æ›´æ–°é¤˜é¡
  4. æª¢æŸ¥å„ªåŒ–å™¨
  5. åŸ·è¡Œç­–ç•¥é‚è¼¯
  6. è³‡æ–™åº«å¿«ç…§

### 2. æ–‡ä»¶çµæ§‹

```
NoAI/
â”œâ”€â”€ strategy/                    # ç­–ç•¥å±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_strategy.py
â”‚   â””â”€â”€ grid_strategy.py
â”‚
â”œâ”€â”€ optimizer/                  # å„ªåŒ–å±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ strategy_optimizer.py
â”‚
â”œâ”€â”€ engine/                     # åŸ·è¡Œå±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ bot_engine.py
â”‚
â”œâ”€â”€ main_modular.py            # æ¨¡çµ„åŒ–æ¶æ§‹å…¥å£
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ architecture_design.md  # æ¶æ§‹è¨­è¨ˆæ–‡æª”
    â”œâ”€â”€ quick_start.md          # å¿«é€Ÿé–‹å§‹æŒ‡å—
    â””â”€â”€ æ¶æ§‹é‡æ§‹ç¸½çµ.md         # æœ¬æ–‡æª”
```

### 3. æ–‡æª”

- âœ… `docs/architecture_design.md` - è©³ç´°æ¶æ§‹è¨­è¨ˆæ–‡æª”
- âœ… `docs/quick_start.md` - å¿«é€Ÿé–‹å§‹æŒ‡å—
- âœ… `docs/æ¶æ§‹é‡æ§‹ç¸½çµ.md` - æœ¬æ–‡æª”

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. ä¸‰å±¤åˆ†é›¢æ¶æ§‹

```
Strategy Layer (ç­–ç•¥å±¤)
    â†“ ç”Ÿæˆä¿¡è™Ÿ
Execution Layer (åŸ·è¡Œå±¤)
    â†“ åŸ·è¡Œè¨‚å–®
Optimization Layer (å„ªåŒ–å±¤)
    â†“ èª¿æ•´åƒæ•¸
```

### 2. å¯æ³¨å…¥åƒæ•¸è¨­è¨ˆ

æ‰€æœ‰ç­–ç•¥åƒæ•¸éƒ½æ˜¯**é¡å±¬æ€§**ï¼Œå¯ä»¥é€šé `update_config()` æ–¹æ³•å‹•æ…‹ä¿®æ”¹ï¼š

```python
# ç­–ç•¥åƒæ•¸ï¼ˆé¡å±¬æ€§ï¼‰
self.small_gap: Decimal = Decimal("0.035")
self.ema_span_fast_bars: int = 10

# AI Agent å¯ä»¥å‹•æ…‹èª¿æ•´
strategy.update_config({'small_gap': Decimal('0.05')})
```

### 3. ç‹€æ…‹è§€å¯Ÿèˆ‡çå‹µåé¥‹

- **ç‹€æ…‹å‘é‡**: ç­–ç•¥å°å‡ºç•¶å‰ç‹€æ…‹ï¼ˆæŒ‡æ¨™ã€åƒæ•¸ç­‰ï¼‰
- **ç¸¾æ•ˆè¿½è¹¤**: è¨˜éŒ„åƒæ•¸èª¿æ•´å‰å¾Œçš„ç¸¾æ•ˆ
- **çå‹µè¨ˆç®—**: ç‚ºæœªä¾† RL æ¨¡å‹æº–å‚™

### 4. å®‰å…¨æ©Ÿåˆ¶

- åƒæ•¸ç¯„åœé©—è­‰
- éŒ¯èª¤è™•ç†èˆ‡é‡è©¦
- å®‰å…¨æ¨¡å¼ï¼ˆåœæ­¢ä¸‹å–®ä½†ä¿æŒç›£æ§ï¼‰

## ğŸ”„ åƒæ•¸èª¿æ•´æµç¨‹

### å®Œæ•´æµç¨‹ç¤ºä¾‹

```python
# 1. Optimizer è§€å¯Ÿå¸‚å ´
market_state = optimizer.observe_market_state(
    current_price=Decimal('30.5'),
    total_equity=Decimal('1000000'),
    realized_pnl=Decimal('5000'),
    active_orders_count=10
)

# 2. Optimizer è¨ˆç®—æ–°åƒæ•¸
new_params = optimizer.optimize_parameters(market_state, performance)
# â†’ {'small_gap': Decimal('0.042')}

# 3. Optimizer æ‡‰ç”¨åƒæ•¸
optimizer.apply_parameters(new_params)
# â†’ èª¿ç”¨ strategy.update_config(new_params)

# 4. Strategy æ›´æ–°åƒæ•¸
strategy.update_config(new_params)
# â†’ self.small_gap = Decimal('0.042')
# â†’ self._rebuild_grid_layers()

# 5. BotEngine åœ¨ä¸‹å€‹å¾ªç’°é‡å»ºç¶²æ ¼
# â†’ ä½¿ç”¨æ–°çš„é–“è·åƒæ•¸
```

## ğŸ“Š æŠ€è¡“ç´°ç¯€

### åƒæ•¸èª¿æ•´ç¯„åœé™åˆ¶

```python
param_bounds = {
    'small_gap': {'min': 0.01, 'max': 0.10},
    'ema_span_fast_bars': {'min': 5, 'max': 20},
    'ema_span_slow_bars': {'min': 30, 'max': 100},
    'bias_high': {'min': 0.5, 'max': 0.8},
    'bias_low': {'min': 0.2, 'max': 0.5}
}
```

### ç‹€æ…‹å‘é‡çµæ§‹

```python
{
    'strategy_name': str,
    'is_active': bool,
    'indicators': {
        'ema_fast': float,
        'ema_slow': float,
        'atr': float,
        'adx': float
    },
    'config_snapshot': {
        'small_gap': float,
        'ema_span_fast_bars': int,
        ...
    }
}
```

### ç¸¾æ•ˆæŒ‡æ¨™

```python
{
    'roi': Decimal,              # ç¸½æ”¶ç›Šç‡
    'realized_pnl': Decimal,     # å·²å¯¦ç¾æç›Š
    'max_drawdown': Decimal,     # æœ€å¤§å›æ’¤
    'total_equity': Decimal,     # ç¸½æ¬Šç›Š
    'sharpe_ratio': float        # å¤æ™®æ¯”ç‡
}
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬é‹è¡Œ

```bash
python main_modular.py
```

### é…ç½®å„ªåŒ–å™¨

åœ¨ `config_usdttwd.yaml` ä¸­æ·»åŠ ï¼š

```yaml
optimizer:
  optimization_enabled: true
  optimization_interval_sec: 3600
  min_performance_change_threshold: 0.05
  param_bounds:
    small_gap:
      min: 0.01
      max: 0.10
    # ...
```

## ğŸ”® æœªä¾†æ“´å±•

### 1. å¼·åŒ–å­¸ç¿’æ•´åˆ

```python
class RLStrategyOptimizer(StrategyOptimizer):
    def optimize_parameters(self, market_state, performance):
        # ä½¿ç”¨ RL æ¨¡å‹é¸æ“‡å‹•ä½œ
        action = self.rl_model.predict(market_state)
        return self._action_to_params(action)
```

### 2. å¤šç­–ç•¥æ”¯æ´

```python
strategies = [
    GridStrategy(config),
    TrendFollowingStrategy(config)
]
```

### 3. åˆ†æ•£å¼å„ªåŒ–

å¤šå€‹ Optimizer å¯¦ä¾‹å”åŒå·¥ä½œã€‚

## ğŸ“ é·ç§»æŒ‡å—

### å¾èˆŠæ¶æ§‹é·ç§»

1. **ä¿ç•™ç¾æœ‰åŠŸèƒ½**
   - âœ… `max_async_api.py` - ä¿ç•™
   - âœ… `db.py` - ä¿ç•™
   - âœ… `telegram_alerter.py` - ä¿ç•™

2. **é€æ­¥é·ç§»**
   - å…ˆé‹è¡Œ `main_modular.py` æ¸¬è©¦
   - ç¢ºèªåŠŸèƒ½æ­£å¸¸å¾Œï¼Œé€æ­¥é·ç§»é…ç½®
   - æœ€å¾Œæ›¿æ› `strategy_usdttwd_grid.py`

3. **é…ç½®èª¿æ•´**
   - æ·»åŠ  `optimizer` é…ç½®å€å¡Š

## âœ… ç¬¦åˆå°ˆæ¡ˆè¦å‰‡

### âœ… æ¶æ§‹åŸå‰‡
- [x] ä¸‰å±¤åˆ†é›¢ï¼ˆStrategy / Execution / Optimizationï¼‰
- [x] å¯æ³¨å…¥åƒæ•¸ï¼ˆé¡å±¬æ€§ï¼‰
- [x] ä¿ç•™ `max_async_api.py`, `db.py`, `telegram_alerter.py`

### âœ… AI Agent æº–å‚™
- [x] ç‹€æ…‹è§€å¯Ÿï¼ˆState Vectorï¼‰
- [x] çå‹µåé¥‹ï¼ˆPerformance Trackingï¼‰
- [x] åƒæ•¸èª¿æ•´ä»‹é¢

### âœ… ç·¨ç¢¼æ¨™æº–
- [x] é¡å‹æç¤ºï¼ˆType Hintsï¼‰
- [x] ç•°æ­¥æ ¸å¿ƒï¼ˆasync/awaitï¼‰
- [x] éŒ¯èª¤è™•ç†

## ğŸ“ å­¸ç¿’è³‡æº

- **æ¶æ§‹è¨­è¨ˆ**: `docs/architecture_design.md`
- **å¿«é€Ÿé–‹å§‹**: `docs/quick_start.md`
- **Freqtrade åƒè€ƒ**: `freqtrade-develop/freqtrade/strategy/interface.py`
- **åŸå§‹å¯¦ç¾**: `strategy_usdttwd_grid.py`

## ğŸ“ æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹åƒè€ƒï¼š
1. æ¶æ§‹è¨­è¨ˆæ–‡æª”
2. å¿«é€Ÿé–‹å§‹æŒ‡å—
3. ä»£ç¢¼è¨»é‡‹

---

**ç‰ˆæœ¬**: 1.0  
**æ—¥æœŸ**: 2025-01-23  
**ç‹€æ…‹**: âœ… å®Œæˆ

