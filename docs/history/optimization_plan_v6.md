# 第六次優化方案：擴展指標複合判斷 + 業界最佳實踐

**時間**: 2025-12-13  
**背景**: 第五次優化（20000次迭代）仍未找到有效參數

## 📊 當前狀況

### 第五次優化結果
- **迭代次數**: 20000
- **有效參數**: 0個 ❌
- **篩選條件**: ROI > 1% AND MaxDD < 15%
- **耗時**: 633.5分鐘（10.56小時）
- **關鍵發現**: 即使使用多指標複合判斷（EMA + ADX + RSI + MACD），仍無法找到有效參數

## 🔍 可用指標分析

### 當前已使用的指標
1. ✅ **EMA**（指數移動平均線）- 趨勢方向判斷
2. ✅ **ADX**（平均方向指數）- 趨勢強度判斷
3. ✅ **RSI**（相對強弱指數）- 超買超賣判斷
4. ✅ **MACD**（移動平均收斂發散）- 動量判斷
5. ✅ **ATR**（平均真實波幅）- 波動率判斷（用於網格間距）

### 未使用的指標（可加入）
1. ⚠️ **Bollinger Bands（布林帶）** - 價格位置判斷
2. ⚠️ **Stochastic Oscillator（隨機震盪指標）** - 超買超賣判斷
3. ⚠️ **OBV（能量潮指標）** - 成交量確認（需要成交量數據）

## 💡 業界最佳實踐參考

### 1. 網格交易策略常見參數設置

根據量化交易社群經驗，網格交易策略的常見參數：

| 參數類型 | 常見範圍 | 說明 |
|---------|---------|------|
| **網格間距** | 0.1% - 0.5% | 基於ATR或價格百分比 |
| **網格層數** | 10 - 30層 | 每邊5-15層 |
| **單筆訂單大小** | 1% - 5% | 總資金的1-5% |
| **止盈比例** | 0.5% - 2% | 單筆交易止盈 |
| **止損比例** | 1% - 3% | 單筆交易止損 |

### 2. 趨勢跟隨策略常見參數設置

| 參數類型 | 常見範圍 | 說明 |
|---------|---------|------|
| **EMA快線** | 12 - 50 | 短期趨勢 |
| **EMA慢線** | 26 - 200 | 長期趨勢 |
| **RSI週期** | 14 - 21 | 超買超賣判斷 |
| **RSI超買** | 70 - 80 | 賣出信號 |
| **RSI超賣** | 20 - 30 | 買入信號 |
| **MACD快線** | 12 | 標準設置 |
| **MACD慢線** | 26 | 標準設置 |
| **MACD信號線** | 9 | 標準設置 |
| **ADX門檻** | 20 - 25 | 趨勢強度確認 |

### 3. 複合指標判斷最佳實踐

**業界常見的複合判斷邏輯**：

1. **趨勢確認 + 動量確認 + 超買超賣過濾**
   - EMA交叉（趨勢方向）
   - MACD金叉/死叉（動量確認）
   - RSI不在極端區域（過濾假信號）

2. **價格位置 + 趨勢 + 波動率**
   - 布林帶位置（價格相對位置）
   - EMA趨勢（趨勢方向）
   - ATR波動率（市場活躍度）

3. **多時間框架確認**
   - 高時間框架趨勢
   - 低時間框架進場點

## 🔧 第六次優化方案

### 方案A：加入布林帶和隨機震盪指標（推薦）⭐⭐⭐⭐⭐

#### 1.1 新增指標計算

**布林帶（Bollinger Bands）**：
- 判斷價格相對位置
- 價格接近下軌：可能超賣，適合買入
- 價格接近上軌：可能超買，適合賣出
- 價格在中軌附近：震盪市場，適合網格交易

**隨機震盪指標（Stochastic Oscillator）**：
- %K和%D線
- %K > 80：超買區域
- %K < 20：超賣區域
- %K與%D交叉：買賣信號

#### 1.2 擴展複合進場條件

**多頭進場條件（OR邏輯，進一步放寬）**：

- **條件A（主要）**: EMA快線 > 慢線 AND ADX > 10 AND RSI > 50 AND MACD > 0
- **條件B（輔助）**: EMA快線 > 慢線 AND MACD > 0 AND RSI > 45 AND 價格接近布林帶下軌
- **條件C（激進）**: EMA快線 > 慢線 AND ADX > 8 AND 隨機指標%K < 30（超賣反彈）
- **條件D（極度放寬）**: EMA快線 > 慢線 AND ADX > 6（最低門檻）

**空頭進場條件（OR邏輯，進一步放寬）**：

- **條件A（主要）**: EMA快線 < 慢線 AND ADX > 10 AND RSI < 50 AND MACD < 0
- **條件B（輔助）**: EMA快線 < 慢線 AND MACD < 0 AND RSI < 55 AND 價格接近布林帶上軌
- **條件C（激進）**: EMA快線 < 慢線 AND ADX > 8 AND 隨機指標%K > 70（超買回調）
- **條件D（極度放寬）**: EMA快線 < 慢線 AND ADX > 6（最低門檻）

#### 1.3 參數範圍調整（參考業界最佳實踐）

| 參數 | 當前範圍 | 建議範圍（業界標準） | 說明 |
|------|---------|-------------------|------|
| `ema_span_fast_bars` | 100 - 600 | **12 - 50** | ✅ 使用業界標準短期EMA |
| `ema_span_slow_bars` | 300 - 2000 | **26 - 200** | ✅ 使用業界標準長期EMA |
| `rsi_period` | 10 - 20 | **14 - 21** | ✅ 使用業界標準RSI週期 |
| `rsi_bull_threshold` | 45 - 55 | **50 - 60** | ✅ 放寬多頭RSI門檻 |
| `rsi_bear_threshold` | 45 - 55 | **40 - 50** | ✅ 放寬空頭RSI門檻 |
| `adx_strength_threshold` | 8 - 15 | **6 - 12** | ✅ 進一步降低ADX門檻 |
| `adx_min_threshold` | 6 - 12 | **5 - 10** | ✅ 降低最低ADX門檻 |
| `bollinger_window` | - | **20** | ✅ 新增布林帶週期 |
| `bollinger_k` | - | **2.0** | ✅ 新增布林帶標準差倍數 |
| `stochastic_k_period` | - | **14** | ✅ 新增隨機指標K週期 |
| `stochastic_d_period` | - | **3** | ✅ 新增隨機指標D週期 |

### 方案B：簡化策略，專注網格交易（備選）⭐⭐⭐

如果趨勢跟隨策略在強趨勢市場表現不佳，可以：

1. **完全禁用趨勢跟隨模式**
2. **專注網格交易優化**
3. **使用布林帶動態調整網格範圍**
4. **使用RSI和隨機指標過濾極端市場**

### 方案C：多時間框架策略（進階）⭐⭐⭐⭐

1. **高時間框架（5分鐘或15分鐘）判斷趨勢**
2. **低時間框架（1分鐘）執行網格交易**
3. **只在高時間框架趨勢明確時執行**

## 📋 實施步驟

### 步驟1：加入新指標計算

1. 在`backtester_grid.py`中加入布林帶和隨機震盪指標計算
2. 將指標存入DataFrame以便使用

### 步驟2：擴展複合進場條件

1. 實現包含布林帶和隨機指標的複合條件
2. 進一步放寬進場門檻（ADX最低降至6）

### 步驟3：調整參數優化器

1. 加入布林帶和隨機指標相關參數
2. 調整EMA、RSI等參數範圍至業界標準
3. 放寬篩選條件（ROI > 0.5%）

### 步驟4：重新運行優化

```bash
cd backtest
python optimize_params_parallel.py \
    --csv usdttwd_1m_2025.csv \
    --config config_usdttwd.yaml \
    --target 100 \
    --max-iter 20000 \
    --workers 4 \
    --output .
```

## 📈 預期改進

1. **進場次數**: 從3-4次提升至50-100次（進一步放寬條件）
2. **ROI**: 從-10.68%改善至0-3%（多指標確認減少虧損）
3. **有效參數**: 預期能找到ROI > 0.5%的參數

## ⚠️ 注意事項

1. **避免過度優化**: 不要加入太多指標導致過擬合
2. **保持簡單**: OR邏輯比AND邏輯更寬鬆，更容易觸發
3. **參考業界標準**: 使用業界驗證過的參數範圍
4. **逐步調整**: 先實施方案A，如果仍不理想再考慮方案B或C

## 🎯 關鍵改進點

1. **加入布林帶**: 判斷價格相對位置，過濾極端市場
2. **加入隨機指標**: 提供另一個超買超賣判斷維度
3. **參考業界標準**: 使用業界驗證過的參數範圍
4. **進一步放寬條件**: ADX最低門檻降至6，增加交易機會

---

**建議**: 優先實施方案A（加入布林帶和隨機指標），這是最有可能改善表現的方向。

