# 專案運行指南

## 快速開始

### 1. 環境設置

```bash
# 安裝依賴
pip install -r requirements.txt

# 建立 .env 檔案
cat > .env << EOF
MAX_API_KEY="your_api_key"
MAX_API_SECRET="your_api_secret"
TG_TOKEN="your_telegram_token"
TG_CHAT_ID="your_chat_id"
DB_URI="sqlite+aiosqlite:///trading.db"
EOF
```

### 2. 初始化資料庫

```bash
python db.py
```

### 3. 運行實盤策略

```bash
python strategy_usdttwd_grid.py
```

### 4. 執行回測

```bash
cd backtest
python backtester_grid.py \
    --csv usdttwd_1m_25y7m.csv \
    --config config_usdttwd.yaml \
    --init_usdt 10000.0 \
    --init_twd 300000.0
```

## 檔案說明

| 檔案 | 用途 | 運行方式 |
|------|------|----------|
| `strategy_usdttwd_grid.py` | 實盤交易主程式 | `python strategy_usdttwd_grid.py` |
| `backtest/backtester_grid.py` | 回測系統 | `python backtester_grid.py --csv <檔案> --config <配置>` |
| `risk_controller.py` | 風險控制（自動調用） | 無需單獨運行 |
| `db.py` | 資料庫初始化 | `python db.py` |
| `check_db_pnl.py` | 查詢PNL | `python check_db_pnl.py` |
| `test_telegram.py` | 測試通知 | `python test_telegram.py` |

## 配置檔案

主要配置在 `config_usdttwd.yaml`，包含：
- 網格參數（間距、層數、訂單大小）
- EMA參數（快慢線週期）
- 風險控制參數
- 黑天鵝保護設定

## 停止策略

按 `Ctrl+C` 或發送 SIGTERM 信號，程式會：
1. 撤銷所有掛單
2. 保存當前狀態
3. 安全退出

